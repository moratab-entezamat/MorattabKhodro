<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>تست خودرو خروج - مرتب خودرو</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<header>
  <h1>مرتب خودرو</h1>
  <div class="menu-toggle" id="menuToggle" aria-label="باز کردن منو" role="button" tabindex="0">
    <span></span><span></span><span></span>
  </div>
</header>

<nav id="sideMenu" aria-hidden="true">
  <a href="index.html">ورود خودرو</a>
  <a href="exit.html">خروج خودرو</a>
  <a href="test_exit.html">خروج خودرو جهت آزمون</a>
  <a href="test_entry.html">ورود خودرو پس از آزمون</a>
  <a href="report.html">گزارش</a>
</nav>

<main>
  <h2>خدمات خروج خودرو جهت آزمون</h2>
  <form id="testExitForm">
    <label for="plate">شماره پلاک خودرو</label>
    <input type="text" id="plate" name="plate" required />

    <label for="isCorporate" style="display: inline-flex; align-items: center; margin: -4px 0 15px 0; font-weight: 700; color: #4a58a7; cursor: pointer;">
      <input type="checkbox" id="isCorporate" name="isCorporate" style="margin-left: 8px; width: 18px; height: 18px; cursor: pointer;" />
      خودروی سازمانی
    </label>

    <label for="driver">کارشناس تست خودرو</label>
    <select id="driver" name="driver" required>
      <option value="" disabled selected>انتخاب کنید</option>
      <option value="محمود بندر">محمود بندر</option>
      <option value="محسن طوسیانی">محسن طوسیانی</option>
      <option value="حسین شمس">حسین شمس</option>
      <option value="حامد قزل">حامد قزل</option>
      <option value="مجتبی رضایی">مجتبی رضایی</option>
      <option value="فرشاد مشتعل">فرشاد مشتعل</option>
    </select>

    <label for="companion">همراه (اختیاری)</label>
    <select id="companion" name="companion">
      <option value="" disabled selected>انتخاب کنید</option>
      <option value="مالک">مالک</option>
      <option value="محمود بندر">محمود بندر</option>
      <option value="محسن طوسیانی">محسن طوسیانی</option>
      <option value="حسین شمس">حسین شمس</option>
      <option value="حامد قزل">حامد قزل</option>
      <option value="مجتبی رضایی">مجتبی رضایی</option>
      <option value="فرشاد مشتعل">فرشاد مشتعل</option>
    </select>

    <label for="kilometer">کیلومتر خودرو</label>
    <input type="number" id="kilometer" name="kilometer" required inputmode="numeric" />

    <div class="datetime-row">
      <div>
        <label for="date">تاریخ خروج جهت تست</label>
        <input type="text" id="date" name="date" placeholder="" required />
      </div>
      <div>
        <label for="time">ساعت خروج جهت تست</label>
        <input type="text" id="time" name="time" placeholder="" required />
      </div>
    </div>

    <button type="submit">ثبت اطلاعات</button>
  </form>
</main>

<script>
  // منوی کناری
  const menuToggle = document.getElementById('menuToggle');
  const sideMenu = document.getElementById('sideMenu');

  function toggleMenu() {
    const isOpen = sideMenu.classList.toggle('open');
    sideMenu.setAttribute('aria-hidden', !isOpen);
  }

  menuToggle.addEventListener('click', toggleMenu);
  document.addEventListener('click', e => {
    if (!sideMenu.contains(e.target) && !menuToggle.contains(e.target)) {
      sideMenu.classList.remove('open');
      sideMenu.setAttribute('aria-hidden', 'true');
    }
  });

  menuToggle.addEventListener('keydown', e => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      toggleMenu();
    }
  });

  // ثبت فرم و ذخیره داده‌ها با توجه به چک‌باکس
  const form = document.getElementById('testExitForm');

  form.addEventListener('submit', e => {
    e.preventDefault();

    const plate = form.plate.value.trim();
    const driver = form.driver.value;
    const companion = form.companion.value;
    const kilometer = form.kilometer.value;
    const date = form.date.value.trim();
    const time = form.time.value.trim();
    const isCorporate = form.isCorporate.checked;

    const type = isCorporate ? 'خروج خودرو سازمانی جهت آزمون' : 'خروج خودرو جهت آزمون';

    let data = JSON.parse(localStorage.getItem('carManagementData')) || [];

    const newEntry = {
      type,
      plate,
      driver,
      companion: companion || null,
      kilometer: Number(kilometer),
      date,
      time,
      timestamp: new Date().toISOString()
    };

    data.push(newEntry);
    localStorage.setItem('carManagementData', JSON.stringify(data));

    alert('اطلاعات با موفقیت ثبت شد');
    form.reset();
  });
</script>
</body>
</html>
